<!DOCTYPE html>
<html>

<head>
    <title>Test Booking APIs</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <h1>API Test</h1>
    <button onclick="testGuestBooking()">Test Guest Booking</button>
    <button onclick="testAdminGuest()">Test Admin Guest Creation</button>
    <div id="results"></div>

    <script>
        async function testGuestBooking() {
            try {
                const log = document.getElementById('results');
                log.innerHTML = '<h3>Testing Guest Booking Flow...</h3>';

                // 1. Test guest creation (online booking format)
                const guestData = {
                    first_name: 'John',
                    last_name: 'Doe',
                    middle_name: '',
                    suffix: '',
                    date_of_birth: '1990-01-01',
                    email: 'john.doe@test.com',
                    phone_number: '+639123456789',
                    guest_idtype_id: '1',
                    id_number: 'TEST123456789'
                };

                const formData = new FormData();
                formData.append('operation', 'insertGuest');
                formData.append('json', JSON.stringify(guestData));

                const guestRes = await axios.post('/Hotel-Reservation-Billing-System/api/admin/guests/guests.php', formData);
                log.innerHTML += `<p>Guest Response: ${JSON.stringify(guestRes.data)}</p>`;

                if (guestRes.data && guestRes.data.guest_id) {
                    // 2. Test reservation creation (online booking format)
                    const reservationData = {
                        guest_id: guestRes.data.guest_id,
                        room_type_id: 1, // Just room type, no specific room
                        check_in_date: '2025-09-10',
                        check_out_date: '2025-09-12',
                        guests: 1,
                        reservation_type: 'online'
                    };

                    const resFormData = new FormData();
                    resFormData.append('operation', 'insertReservation');
                    resFormData.append('json', JSON.stringify(reservationData));

                    const reservationRes = await axios.post('/Hotel-Reservation-Billing-System/api/admin/reservations/reservations.php', resFormData);
                    log.innerHTML += `<p>Reservation Response: ${JSON.stringify(reservationRes.data)}</p>`;

                    if (reservationRes.data && reservationRes.data.reservation_id) {
                        log.innerHTML += `<p style="color: green;">✅ Guest Booking Test PASSED!</p>`;
                    } else {
                        log.innerHTML += `<p style="color: red;">❌ Reservation creation failed</p>`;
                    }
                } else {
                    log.innerHTML += `<p style="color: red;">❌ Guest creation failed</p>`;
                }
            } catch (error) {
                document.getElementById('results').innerHTML += `<p style="color: red;">❌ Error: ${error.message}</p>`;
            }
        }

        async function testAdminGuest() {
            try {
                const log = document.getElementById('results');
                log.innerHTML = '<h3>Testing Admin Guest Creation...</h3>';

                // Test admin guest creation format
                const guestData = {
                    first_name: 'Jane',
                    last_name: 'Smith',
                    middle_name: '',
                    suffix: '',
                    date_of_birth: '1985-05-15',
                    email: 'jane.smith@test.com',
                    phone_number: '+639987654321',
                    guest_idtype_id: '1',
                    id_number: 'ADMIN123456789'
                };

                const formData = new FormData();
                formData.append('operation', 'insertGuest');
                formData.append('json', JSON.stringify(guestData));

                const response = await axios.post('/Hotel-Reservation-Billing-System/api/admin/guests/guests.php', formData);
                log.innerHTML += `<p>Admin Guest Response: ${JSON.stringify(response.data)}</p>`;

                if (response.data && (response.data.success === 1 || response.data == 1)) {
                    log.innerHTML += `<p style="color: green;">✅ Admin Guest Test PASSED!</p>`;
                } else {
                    log.innerHTML += `<p style="color: red;">❌ Admin guest creation failed</p>`;
                }
            } catch (error) {
                document.getElementById('results').innerHTML += `<p style="color: red;">❌ Error: ${error.message}</p>`;
            }
        }
    </script>
</body>

</html>